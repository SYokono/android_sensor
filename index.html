<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
    <title>Motion Sensorsサンプル</title>
    <script src="static/js/jquery-3.0.0.min.js" type="text/javascript"></script>
    <script src="static/js/d3.min.js" type="text/javascript"></script>
    <script>
      window.addEventListener("devicemotion", function(event1){
        var x = event1.accelerationIncludingGravity.x;
        var y = event1.accelerationIncludingGravity.y;
        var z = event1.accelerationIncludingGravity.z;
        var result1 = document.getElementById("result1");
        result1.innerHTML =
          "X："+ Math.round(x * 10) / 10 +"<br>" +
          "Y："+ Math.round(y * 10) / 10 +"<br>" +
          "Z："+ Math.round(z * 10) / 10;
      }, true);

      window.addEventListener('deviceorientation', function(event2) {
            var alpha = event2.alpha;
            var beta = event2.beta;
            var gamma = event2.gamma;

        result2.innerHTML =
          "alpha："+ Math.round(alpha * 10) / 10 +"<br>" +
          "beta："+ Math.round(beta * 10) / 10 +"<br>" +
          "gamma："+ Math.round(gamma * 10) / 10;
        }, true);
    </script>
  </head>
  <body>
    <div id="result1"></div>
    <div id="result2"></div>
    <div id="d3graph_x"></div>
    <div id="d3graph_y"></div>
    <div id="d3graph_z"></div>

    <script type="text/javascript">
        $(document).ready(function(){
            stage_x = d3.select("#d3graph_x")
                      .append("svg:svg")
                      .attr("width", $("#d3graph_x").width())
                      .attr("height", 200);

            stage_y = d3.select("#d3graph_y")
                      .append("svg:svg")
                      .attr("width", $("#d3graph_y").width())
                      .attr("height", 200);

            stage_z = d3.select("#d3graph_z")
                      .append("svg:svg")
                      .attr("width", $("#d3graph_z").width())
                      .attr("height", 200);

            setInterval("update()", 100);
        });

        var colors = d3.scale.category10();
        var d3Line = d3.svg.line()
                       .x(function(d,i){return i * 10;})
                       .y(function(d,i){return d;});

        var points_x = new Array();
        var points_y = new Array();
        var points_z = new Array();

        function update() {
            points_x.push(Math.random() * 100 + 100);
            points_y.push(Math.random() * 100 + 100);
            points_z.push(Math.random() * 100 + 100);

            if(points_x.length > $("#d3graph_x").width()/10) {
                points_x.shift();
            }

            if(points_y.length > $("#d3graph_y").width()/10) {
                points_y.shift();
            }

            if(points_z.length > $("#d3graph_z").width()/10) {
                points_z.shift();
            }

            // 削除する
            stage_x.selectAll("path").remove();
            stage_y.selectAll("path").remove();
            stage_z.selectAll("path").remove();

            // 描画する
            stage_x.append("path")
                   .attr("d", d3Line(points_x))
                   .attr("stroke", colors(0))
                   .attr("fill", "none")
                   .attr("opacity", 1);

            stage_y.append("path")
                   .attr("d", d3Line(points_y))
                   .attr("stroke", colors(1))
                   .attr("fill", "none")
                   .attr("opacity", 1);

            stage_z.append("path")
                   .attr("d", d3Line(points_z))
                   .attr("stroke", colors(2))
                   .attr("fill", "none")
                   .attr("opacity", 1);
    }
    </script>
  </body>
</html>